# 出愿时间轴与班主任/管理后台 — 交接说明

本文档供在新对话中交接使用，总结当前「出愿时间轴」及相关弹窗/浮层的实现与进度。

---

## 一、命名与入口变更（已完成）

- **原**：左侧导航为「数据概览」，内含四个入口：出愿重要时间节点查看、概览数字、最新注册用户、最新添加的学校。
- **现**：
  - 导航名称改为 **「出愿时间轴」**，图标为 `fa-calendar-alt`。
  - 该页**只保留一个功能**：「出愿重要时间节点查看」。
  - 已删除：概览数字、最新注册用户、最新添加的学校三个入口及其对应毛玻璃浮层（`overlayStats`、`overlayUsers`、`overlaySchools`）。
- 页面标题（`#pageTitle`）与 `titles.dashboard` 已统一为「出愿时间轴」。

---

## 二、出愿重要时间节点 — 浮层与交互

### 2.1 入口与浮层

- **入口**：在「出愿时间轴」页仅有一个按钮「出愿重要时间节点查看」，点击后打开毛玻璃浮层 `#overlayTimeline`。
- **浮层结构**（`admin/index.html`）：
  - **顶部**：每日/每周提醒看板
    - 「今日要提醒」列表 `#boardToday`
    - 「本周要提醒」列表 `#boardWeek`
  - **中间**：维度选择 + 日期范围
    - 维度下拉框 `#timelineDimension`：全部时间点、出愿开始/截止、邮寄开始/截止、校内考、合格放榜
    - 开始日期 `#timelineStartDate`、结束日期 `#timelineEndDate`
  - **生成按钮**：「开始生成时间轴」`#btnTimelineGenerate`，带沙漏图标与翻转动画
  - **下方**：时间轴展示区 `#timelineRevealZone`，内含纵向时间轴容器 `#timelineAxisContainer`

### 2.2 数据与逻辑要点

- **数据源**：`GET /api/school-master`（项目内 `school-master.json`），约 160+ 所学校，字段含 `mailStart`、`mailEnd`、`mailStartDate`、`mailEndDate`、`examDate`、`examDate2`、`announcementDate` 等。
- **打开浮层时**：调用 `ensureSchoolMasterThenFillBoard()` → 若未缓存则请求 school-master，填充今日/本周看板，并设置默认开始/结束日期；同时隐藏 `#timelineRevealZone`。
- **点击「开始生成时间轴」**：
  1. 取当前维度和日期范围；
  2. 按钮禁用，沙漏图标加 `flip` 动画（约 1.8s）；
  3. 用 `buildTimelineEvents(schools, dimension)` 从学校数据里按维度抽取事件；
  4. 按日期范围过滤后，显示 `#timelineRevealZone`，并调用 `renderVerticalTimelineReveal(container, events)` 渲染纵向时间轴，节点带阶梯式 `.reveal` 动画。

### 2.3 样式与类名（便于后续改版）

- 浮层：`.glass-overlay`、`.glass-overlay-panel`
- 看板：`.remind-board`、`.remind-board-block`、`.remind-board-list`
- 生成按钮与动画：`.btn-generate-wrap`、`.btn-generate`、`.sand-timer-icon`、`@keyframes sandFlip`
- 时间轴：`.timeline-reveal-zone`、`.timeline-vertical-wrap`、`.timeline-vertical-line`、`.timeline-vertical-arrow`、`.timeline-vertical-node`、`.timeline-vertical-nodes`

### 2.4 错误与访问注意

- 若 school-master 请求失败（如未开本地服务、错误 URL、无 `school-master.json`），会提示「加载失败」并给出排查建议（如确认 `npm start`、访问 `http://localhost:3000/admin/`）。
- 浮层关闭：点击浮层内「关闭」按钮或点击浮层背景（backdrop）调用 `closeOverlay('overlayTimeline')`。

---

## 三、与「我的学生」时间轴的对应关系

- **我的学生** 页有独立的一块「出愿时间轴与近期提醒」：基于**班主任学生池**的 `_plans` 数据，维度与日期范围 +「开始生成」逻辑与数据概览侧类似，同样有沙漏动画与纵向时间轴逐步展开；另有「近期重要需要提醒的事项」表格 `#poolRemindTable`（本周/本月）。
- 数据概览侧的时间轴是**全量学校**（school-master）；我的学生侧是**当前池内学生及其出愿计划**。两处代码结构类似，可对照 `buildTimelineEvents` / `buildPoolTimelineEvents`、`renderVerticalTimelineReveal` / `renderPoolTimelineVerticalReveal` 维护。

---

## 四、已移除/不再使用的部分

- 三个浮层 DOM：`#overlayStats`、`#overlayUsers`、`#overlaySchools` 及其内容已删除。
- 三个入口按钮及它们的 open/close 事件已删除；仅保留 `#btnOpenTimelineOverlay` 与 `#closeTimelineOverlay`，以及 `overlayTimeline` 的 backdrop 点击关闭。
- 进入「出愿时间轴」页时不再调用 `loadDashboard()`；页面初次加载时也不再调用 `loadDashboard()`（避免访问已删除的 stat/recent 元素）。`loadDashboard()` 函数仍保留在代码中但当前未被调用，若将来要恢复概览数字等可再接回。

---

## 五、涉及文件

- **主要**：`admin/index.html`（结构、样式、出愿时间轴浮层逻辑、导航与标题文案）。
- **数据**：项目根目录 `school-master.json`；接口 `GET /api/school-master`（见 `server.js`）。
- **鉴权**：`admin/js/admin-auth.js`（如 getApiBase 等），影响前端请求 base URL。

---

## 六、后续可扩展点（供新对话参考）

- 出愿时间轴浮层：增加导出、打印、或按学校/学部筛选。
- 我的学生时间轴与提醒表：与班主任提醒、推送功能联动。
- 若需重新启用「概览数字/最新用户/最新学校」，可恢复对应浮层 DOM 与 `loadDashboard()` 的调用，并接回入口按钮。

---

*文档生成日期：按当前代码状态整理，便于新对话交接。*
