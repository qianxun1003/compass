# 部署前检查与各角色网址说明

## 一、部署前检查结果（执行时间：见上方 Shell 输出）

| 检查项 | 结果 |
|--------|------|
| **1. Git 远程与分支** | 远程：`origin` → `https://github.com/qianxun1003/compass.git`，当前分支 `main` |
| **2. 关键文件** | ✅ server.js, db.js, render.yaml, package.json, init-db.js, adminAuth.js, routes/admin.js, admin/login.html, admin/index.html 均存在 |
| **3. npm 脚本** | ✅ `start` = node server.js，`init-db` = node scripts/init-db.js |
| **4. 本地 .env** | ✅ 存在，DATABASE_URL、JWT_SECRET 已设置（Render 使用自己的环境变量） |
| **5. 待提交变更** | 有修改：admin/index.html, admin/login.html, middleware/adminAuth.js, routes/admin.js, scripts/init-db.js 等；部署前需 **commit + push** |
| **6. Node 与依赖** | ✅ Node v24，依赖已安装（bcrypt, pg, express, jsonwebtoken 等） |
| **7. 应用加载** | ✅ server.js 可加载（本地 3000 端口占用属正常，Render 环境会使用其他端口） |

**结论**：配置与文件齐全，可以部署。部署前请先提交并推送当前修改。

---

## 二、部署方式（Render）

1. **若 Render 已通过 Blueprint 或 GitHub 关联本仓库**  
   - 在项目根目录执行：  
     `git add 需要提交的文件` → `git commit -m "..."` → `git push origin main`  
   - Render 会自动拉取并部署；`preDeployCommand` 会执行 `npm run init-db` 初始化/更新表结构。

2. **若尚未在 Render 创建服务**  
   - 登录 [dashboard.render.com](https://dashboard.render.com/) → 用 **Blueprint** 连接本仓库，或手动创建 **Web Service** + **PostgreSQL**，并按 `render.yaml` 配置 `DATABASE_URL`、`JWT_SECRET`、`NODE_ENV` 等。

3. **首次部署或表结构曾为旧版**  
   - 若后台报错缺少 `role`/`status` 或 `operation_logs`，在 Render 的 Shell 中执行一次：  
     `npm run migrate-admin`  
   - 或本地用 Render 的 `DATABASE_URL` 执行：  
     `DATABASE_URL=<Render 的连接串> node scripts/migrate-admin.js`

---

## 三、各角色应使用的网址（发给你要对应的人）

**正式环境域名**：`https://compass-3sz9.onrender.com`

### 发给学生（选校、出愿计划、时间轴）

一句一句复制发即可：

用户入口（首页）：
https://compass-3sz9.onrender.com/

用户登录：
https://compass-3sz9.onrender.com/login.html

用户注册：
https://compass-3sz9.onrender.com/register.html

---

### 发给班主任（老师、带班）

管理者登录（班主任用这个链接登录，进去后是班主任后台）：
https://compass-3sz9.onrender.com/admin/login.html

---

### 发给管理员（最高权限）

管理者登录（管理员用这个链接登录，进去后是管理后台）：
https://compass-3sz9.onrender.com/admin/login.html

管理者后台（登录后会自动跳转到此页，也可直接收藏）：
https://compass-3sz9.onrender.com/admin/index.html

---

## 四、本地开发用网址（仅自己用）

用户入口：     http://localhost:3000/
用户登录：     http://localhost:3000/login.html
用户注册：     http://localhost:3000/register.html
管理者登录：   http://localhost:3000/admin/login.html
管理者后台：   http://localhost:3000/admin/index.html

---

## 五、正式环境网址汇总（复制用）

用户入口：     https://compass-3sz9.onrender.com/
用户登录：     https://compass-3sz9.onrender.com/login.html
用户注册：     https://compass-3sz9.onrender.com/register.html
管理者登录：   https://compass-3sz9.onrender.com/admin/login.html
管理者后台：   https://compass-3sz9.onrender.com/admin/index.html

---

## 六、班主任/管理员共用「学生端预览」账号说明

从管理后台点击「去学生端」或学生详情里的「条件检索 / 快速检索 / 成绩匹配」时，系统会用**同一个学生端账号**登录，方便所有班主任/管理员统一使用选校、出愿等功能。

| 项目 | 说明 |
|------|------|
| **用户名** | `staff_preview`（学生端顶部可能显示为该用户名） |
| **密码** | **无需告知任何人**。该账号仅由系统在「从管理后台跳转学生端」时自动登录使用，无人需要手动输入密码。密码为随机生成并保存在数据库中。 |
| **邮箱** | `staff_preview@internal.local`（内部标识用） |
| **创建时机** | 首次有班主任/管理员点击「去学生端」等入口时，若数据库中不存在该用户会自动创建。 |

**注意**：若希望学生端界面显示更友好的名称（如「教师预览账号」），可后续在显示逻辑中对 `staff_preview` 做名称映射。
