# 部署前检查与各角色网址说明

## 一、部署前检查结果（执行时间：见上方 Shell 输出）

| 检查项 | 结果 |
|--------|------|
| **1. Git 远程与分支** | 远程：`origin` → `https://github.com/qianxun1003/compass.git`，当前分支 `main` |
| **2. 关键文件** | ✅ server.js, db.js, render.yaml, package.json, init-db.js, adminAuth.js, routes/admin.js, admin/login.html, admin/index.html 均存在 |
| **3. npm 脚本** | ✅ `start` = node server.js，`init-db` = node scripts/init-db.js |
| **4. 本地 .env** | ✅ 存在，DATABASE_URL、JWT_SECRET 已设置（Render 使用自己的环境变量） |
| **5. 待提交变更** | 有修改：admin/index.html, admin/login.html, middleware/adminAuth.js, routes/admin.js, scripts/init-db.js 等；部署前需 **commit + push** |
| **6. Node 与依赖** | ✅ Node v24，依赖已安装（bcrypt, pg, express, jsonwebtoken 等） |
| **7. 应用加载** | ✅ server.js 可加载（本地 3000 端口占用属正常，Render 环境会使用其他端口） |

**结论**：配置与文件齐全，可以部署。部署前请先提交并推送当前修改。

---

## 二、部署方式（Render）

1. **若 Render 已通过 Blueprint 或 GitHub 关联本仓库**  
   - 在项目根目录执行：  
     `git add 需要提交的文件` → `git commit -m "..."` → `git push origin main`  
   - Render 会自动拉取并部署；`preDeployCommand` 会执行 `npm run init-db` 初始化/更新表结构。

2. **若尚未在 Render 创建服务**  
   - 登录 [dashboard.render.com](https://dashboard.render.com/) → 用 **Blueprint** 连接本仓库，或手动创建 **Web Service** + **PostgreSQL**，并按 `render.yaml` 配置 `DATABASE_URL`、`JWT_SECRET`、`NODE_ENV` 等。

3. **首次部署或表结构曾为旧版**  
   - 若后台报错缺少 `role`/`status` 或 `operation_logs`，在 Render 的 Shell 中执行一次：  
     `npm run migrate-admin`  
   - 或本地用 Render 的 `DATABASE_URL` 执行：  
     `DATABASE_URL=<Render 的连接串> node scripts/migrate-admin.js`

---

## 三、各角色应使用的网址（发给你要对应的人）

假设线上域名为：**`https://ichikawaryuugaku-web.onrender.com`**（请替换成你实际的 Render 域名）。

### 1. 学生（选校、出愿计划、时间轴等）

**发给学生用的网址：**

- **首页（推荐作为主入口）**  
  `https://你的域名.onrender.com/`  
  或  
  `https://你的域名.onrender.com/index.html`

- **学生登录页**  
  `https://你的域名.onrender.com/login.html`

说明：学生从首页或登录页进入，使用你为他们创建的学生账号登录，即可使用筛选、出愿计划、时间轴等学生端功能。

---

### 2. 班主任（老师、带班）

**发给班主任用的网址：**

- **管理后台登录（班主任/管理员统一入口）**  
  `https://你的域名.onrender.com/admin/login.html`

说明：班主任打开上述链接 → 看到「班主任/管理后台」登录页 → 用班主任账号登录 → 进入 **班主任后台**（只能看自己的学生、提醒、生成学生账号等，不能改用户角色）。

---

### 3. 管理员（最高权限）

**发给管理员用的网址：**

- **管理后台登录（与班主任同一入口）**  
  `https://你的域名.onrender.com/admin/login.html`

说明：管理员同样打开上述链接 → 用管理员账号登录 → 进入 **管理后台**（可管理用户角色、添加班主任、查看全部用户、操作日志等）。  
同一网址下，系统根据账号的 **角色（role）** 自动区分是「管理员」还是「班主任」界面。

---

## 四、一句话总结（可复制发给对方）

- **学生**：用「首页/学生登录」→ `https://你的域名.onrender.com/` 或 `https://你的域名.onrender.com/login.html`
- **班主任**：用「管理后台」→ `https://你的域名.onrender.com/admin/login.html`（登录后是班主任界面）
- **管理员**：用「管理后台」→ `https://你的域名.onrender.com/admin/login.html`（登录后是管理员界面）

**注意**：把 `你的域名.onrender.com` 替换成你 Render Web Service 的真实域名（如 `ichikawaryuugaku-web.onrender.com`）。
