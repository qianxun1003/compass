# ç‰¹æ®Šæˆç»©è¦æ±‚è®¡ç®—æ¨¡å‹è®¾è®¡æ–¹æ¡ˆ

## ğŸ“‹ ä¸€ã€é—®é¢˜èƒŒæ™¯

å½“å‰è®¡ç®—æ¨¡å‹é‡‡ç”¨**çŸ­æ¿åŸç†ï¼ˆminRatioï¼‰**ï¼Œå¯¹æ‰€æœ‰ç§‘ç›®ä¸€è§†åŒä»ã€‚ä½†å®é™…æƒ…å†µä¸­ï¼š

1. **ç¡¬æ€§æ¡ä»¶**ï¼šæŸäº›å¤§å­¦/å­¦éƒ¨æœ‰ç‰¹æ®Šæˆç»©è¦æ±‚ï¼ˆå¦‚"æ•°å­¦1å¿…é¡»â‰¥150åˆ†"ï¼‰ï¼Œè¿™æ˜¯**å¿…è¦æ¡ä»¶**ï¼Œä¸æ»¡è¶³åˆ™æ— æ³•é€šè¿‡åˆå®¡
2. **æƒé‡å·®å¼‚**ï¼šæœ‰ç‰¹æ®Šè¦æ±‚çš„ç§‘ç›®åº”è¯¥æ¯”æ™®é€šç§‘ç›®**æƒé‡æ›´é«˜**ï¼Œå› ä¸ºå®ƒä»¬æ˜¯"ç¡¬é—¨æ§›"
3. **åŒé‡æ ‡å‡†**ï¼šéœ€è¦åŒæ—¶è€ƒè™‘ï¼š
   - **ç‰¹æ®Šè¦æ±‚**ï¼ˆç¡¬æ€§é—¨æ§›ï¼Œå¿…é¡»æ»¡è¶³ï¼‰
   - **å‚è€ƒåˆ†æ•°**ï¼ˆåŸºäºåˆæ ¼å®ç»©çš„ç»Ÿè®¡å€¼ï¼Œç”¨äºåŒ¹é…åº¦è®¡ç®—ï¼‰

---

## ğŸ¯ äºŒã€è®¾è®¡ç›®æ ‡

1. **ç¡¬æ€§æ¡ä»¶æ£€æŸ¥**ï¼šä¸æ»¡è¶³ç‰¹æ®Šè¦æ±‚çš„å¤§å­¦/å­¦éƒ¨ï¼Œç›´æ¥æ ‡è®°ä¸º"ä¸ç¬¦åˆæ¡ä»¶"
2. **å·®å¼‚åŒ–æƒé‡**ï¼šæœ‰ç‰¹æ®Šè¦æ±‚çš„ç§‘ç›®åœ¨åŒ¹é…åº¦è®¡ç®—ä¸­æƒé‡æ›´é«˜
3. **å‘åå…¼å®¹**ï¼šæ²¡æœ‰ç‰¹æ®Šè¦æ±‚çš„å¤§å­¦/å­¦éƒ¨ï¼Œä¿æŒåŸæœ‰è®¡ç®—é€»è¾‘
4. **çµæ´»æ‰©å±•**ï¼šæ”¯æŒæœªæ¥å¯èƒ½å‡ºç°çš„å…¶ä»–ç‰¹æ®Šè¦æ±‚ç±»å‹

---

## ğŸ”§ ä¸‰ã€è®¡ç®—æ¨¡å‹è®¾è®¡

### 3.1 æ•°æ®è§£æ

é¦–å…ˆéœ€è¦è§£æ `specialRequirements` å­—æ®µï¼š

```javascript
/**
 * è§£æç‰¹æ®Šæˆç»©è¦æ±‚å­—ç¬¦ä¸²
 * @param {string} requirementStr - æ ¼å¼ï¼š'æ•°å­¦1:150,æ—¥è¯­:300'
 * @returns {Object} - { 'æ•°å­¦1': 150, 'æ—¥è¯­': 300 }
 */
function parseSpecialRequirements(requirementStr) {
    if (!requirementStr || !requirementStr.trim()) {
        return {};
    }
    
    const requirements = {};
    const parts = requirementStr.split(',').map(s => s.trim());
    
    for (const part of parts) {
        const [subject, score] = part.split(':').map(s => s.trim());
        if (subject && score) {
            const scoreNum = parseFloat(score);
            if (!isNaN(scoreNum)) {
                requirements[subject] = scoreNum;
            }
        }
    }
    
    return requirements;
}
```

### 3.2 ç¡¬æ€§æ¡ä»¶æ£€æŸ¥

**ç¬¬ä¸€æ­¥ï¼šæ£€æŸ¥æ˜¯å¦æ»¡è¶³æ‰€æœ‰ç‰¹æ®Šè¦æ±‚**

```javascript
/**
 * æ£€æŸ¥æ˜¯å¦æ»¡è¶³ç‰¹æ®Šæˆç»©è¦æ±‚ï¼ˆç¡¬æ€§æ¡ä»¶ï¼‰
 * @param {Object} userScores - ç”¨æˆ·å„ç§‘æˆç»©
 * @param {Object} specialReqs - ç‰¹æ®Šè¦æ±‚å¯¹è±¡ { 'æ•°å­¦1': 150, ... }
 * @returns {Object} - { passed: boolean, failedSubjects: [] }
 */
function checkSpecialRequirements(userScores, specialReqs) {
    const failedSubjects = [];
    
    for (const [subject, minScore] of Object.entries(specialReqs)) {
        const userScore = getUserScoreForSubject(userScores, subject);
        
        // å¦‚æœç”¨æˆ·åˆ†æ•° < ç‰¹æ®Šè¦æ±‚æœ€ä½åˆ†ï¼Œåˆ™ä¸ç¬¦åˆæ¡ä»¶
        if (userScore < minScore) {
            failedSubjects.push({
                subject: subject,
                required: minScore,
                actual: userScore,
                gap: minScore - userScore
            });
        }
    }
    
    return {
        passed: failedSubjects.length === 0,
        failedSubjects: failedSubjects
    };
}
```

**å¦‚æœ `passed === false`ï¼Œåˆ™è¯¥å¤§å­¦/å­¦éƒ¨ç›´æ¥æ ‡è®°ä¸º"ä¸ç¬¦åˆæ¡ä»¶"ï¼ˆ`blocked` çŠ¶æ€ï¼‰ï¼Œä¸å†å‚ä¸åç»­åŒ¹é…åº¦è®¡ç®—ã€‚**

### 3.3 åŠ æƒåŒ¹é…åº¦è®¡ç®—

**ç¬¬äºŒæ­¥ï¼šå¯¹äºé€šè¿‡ç¡¬æ€§æ¡ä»¶æ£€æŸ¥çš„å¤§å­¦/å­¦éƒ¨ï¼Œè®¡ç®—åŠ æƒåŒ¹é…åº¦**

#### æ–¹æ¡ˆAï¼šæƒé‡å·®å¼‚åŒ–æ–¹æ¡ˆï¼ˆæ¨èï¼‰

**æ ¸å¿ƒæ€æƒ³**ï¼šæœ‰ç‰¹æ®Šè¦æ±‚çš„ç§‘ç›®æƒé‡æ›´é«˜ï¼Œå› ä¸ºå®ƒä»¬æ›´é‡è¦ã€‚

```javascript
/**
 * è®¡ç®—åŠ æƒåŒ¹é…åº¦
 * @param {Object} userScores - ç”¨æˆ·å„ç§‘æˆç»©
 * @param {Array} requiredSubjects - éœ€è¦çš„ç§‘ç›®åˆ—è¡¨
 * @param {Object} thresholds - å„ç§‘å‚è€ƒåˆ†æ•° { 'æ—¥è¯­': 300, ... }
 * @param {Object} specialReqs - ç‰¹æ®Šè¦æ±‚ { 'æ•°å­¦1': 150, ... }
 * @returns {number} - åŠ æƒåŒ¹é…åº¦
 */
function calculateWeightedScoreEffect(userScores, requiredSubjects, thresholds, specialReqs) {
    const ratios = [];
    const weights = [];
    
    for (const subject of requiredSubjects) {
        const userScore = getUserScoreForSubject(userScores, subject);
        const threshold = thresholds[subject];
        
        if (!threshold || threshold <= 0) continue;
        
        // è®¡ç®—è¾¾æˆç‡
        const ratio = userScore / threshold;
        ratios.push(ratio);
        
        // è®¡ç®—æƒé‡ï¼šæœ‰ç‰¹æ®Šè¦æ±‚çš„ç§‘ç›®æƒé‡æ›´é«˜
        // åŸºç¡€æƒé‡ = 1.0
        // æœ‰ç‰¹æ®Šè¦æ±‚ï¼šæƒé‡ = 2.0ï¼ˆæƒé‡ç¿»å€ï¼‰
        const weight = specialReqs[subject] ? 2.0 : 1.0;
        weights.push(weight);
    }
    
    if (ratios.length === 0) return 0;
    
    // åŠ æƒå¹³å‡ï¼ˆä½†æ›´åå‘æœ€å°å€¼ï¼‰
    // æ–¹æ³•1ï¼šåŠ æƒå‡ ä½•å¹³å‡ï¼ˆæ›´åå‘æœ€å°å€¼ï¼‰
    let weightedProduct = 1;
    let totalWeight = 0;
    for (let i = 0; i < ratios.length; i++) {
        weightedProduct *= Math.pow(ratios[i], weights[i]);
        totalWeight += weights[i];
    }
    const weightedGeometricMean = Math.pow(weightedProduct, 1 / totalWeight);
    
    // æ–¹æ³•2ï¼šåŠ æƒè°ƒå’Œå¹³å‡ï¼ˆæ›´åå‘æœ€å°å€¼ï¼‰
    let weightedHarmonicSum = 0;
    totalWeight = 0;
    for (let i = 0; i < ratios.length; i++) {
        weightedHarmonicSum += weights[i] / ratios[i];
        totalWeight += weights[i];
    }
    const weightedHarmonicMean = totalWeight / weightedHarmonicSum;
    
    // æ–¹æ³•3ï¼šæ··åˆæ–¹æ¡ˆï¼ˆæ¨èï¼‰
    // å–æœ€å°å€¼ï¼ˆçŸ­æ¿åŸç†ï¼‰å’ŒåŠ æƒå¹³å‡çš„æ··åˆ
    const minRatio = Math.min(...ratios);
    const weightedArithmeticMean = ratios.reduce((sum, r, i) => sum + r * weights[i], 0) / weights.reduce((a, b) => a + b, 0);
    
    // å¦‚æœæœ‰ç‰¹æ®Šè¦æ±‚çš„ç§‘ç›®ï¼Œæ›´åå‘æœ€å°å€¼ï¼›å¦åˆ™ä½¿ç”¨åŠ æƒå¹³å‡
    const hasSpecialReqs = Object.keys(specialReqs).length > 0;
    const scoreEffect = hasSpecialReqs 
        ? minRatio * 0.7 + weightedArithmeticMean * 0.3  // æ›´åå‘æœ€å°å€¼
        : minRatio * 0.5 + weightedArithmeticMean * 0.5;  // å¹³è¡¡
    
    return Math.min(Math.max(scoreEffect, 0), 2);  // é™åˆ¶åœ¨0-2ä¹‹é—´
}
```

#### æ–¹æ¡ˆBï¼šåŒé‡é˜ˆå€¼æ–¹æ¡ˆ

**æ ¸å¿ƒæ€æƒ³**ï¼šæœ‰ç‰¹æ®Šè¦æ±‚çš„ç§‘ç›®ä½¿ç”¨ç‰¹æ®Šè¦æ±‚ä½œä¸ºé˜ˆå€¼ï¼Œå…¶ä»–ç§‘ç›®ä½¿ç”¨å‚è€ƒåˆ†æ•°ã€‚

```javascript
function calculateScoreEffectWithDualThresholds(userScores, requiredSubjects, thresholds, specialReqs) {
    const ratios = [];
    
    for (const subject of requiredSubjects) {
        const userScore = getUserScoreForSubject(userScores, subject);
        
        // ä¼˜å…ˆä½¿ç”¨ç‰¹æ®Šè¦æ±‚ä½œä¸ºé˜ˆå€¼ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
        let threshold = specialReqs[subject];
        
        // å¦‚æœæ²¡æœ‰ç‰¹æ®Šè¦æ±‚ï¼Œä½¿ç”¨å‚è€ƒåˆ†æ•°
        if (!threshold) {
            threshold = thresholds[subject];
        }
        
        if (!threshold || threshold <= 0) continue;
        
        const ratio = userScore / threshold;
        ratios.push(ratio);
    }
    
    if (ratios.length === 0) return 0;
    
    // ä»ç„¶ä½¿ç”¨æœ€å°å€¼ï¼ˆçŸ­æ¿åŸç†ï¼‰
    return Math.min(Math.min(...ratios), 2);
}
```

#### æ–¹æ¡ˆCï¼šæƒ©ç½šæœºåˆ¶æ–¹æ¡ˆ

**æ ¸å¿ƒæ€æƒ³**ï¼šä¸æ»¡è¶³ç‰¹æ®Šè¦æ±‚çš„ç§‘ç›®ç»™äºˆé¢å¤–æƒ©ç½šï¼Œå³ä½¿æ»¡è¶³å‚è€ƒåˆ†æ•°ã€‚

```javascript
function calculateScoreEffectWithPenalty(userScores, requiredSubjects, thresholds, specialReqs) {
    const ratios = [];
    
    for (const subject of requiredSubjects) {
        const userScore = getUserScoreForSubject(userScores, subject);
        const threshold = thresholds[subject];
        
        if (!threshold || threshold <= 0) continue;
        
        let ratio = userScore / threshold;
        
        // å¦‚æœæœ‰ç‰¹æ®Šè¦æ±‚ä½†æœªæ»¡è¶³ï¼Œç»™äºˆæƒ©ç½š
        if (specialReqs[subject]) {
            const specialThreshold = specialReqs[subject];
            if (userScore < specialThreshold) {
                // æƒ©ç½šï¼šé™ä½è¾¾æˆç‡
                // ä¾‹å¦‚ï¼šå¦‚æœå·®10åˆ†ï¼Œè¾¾æˆç‡é™ä½0.1
                const gap = specialThreshold - userScore;
                const penalty = Math.min(gap / specialThreshold, 0.5);  // æœ€å¤šæƒ©ç½š50%
                ratio = ratio * (1 - penalty);
            } else {
                // æ»¡è¶³ç‰¹æ®Šè¦æ±‚ï¼Œç»™äºˆå¥–åŠ±ï¼ˆç•¥å¾®æå‡ï¼‰
                ratio = ratio * 1.05;  // æå‡5%
            }
        }
        
        ratios.push(ratio);
    }
    
    if (ratios.length === 0) return 0;
    
    return Math.min(Math.min(...ratios), 2);
}
```

---

## ğŸ“Š å››ã€æ¨èæ–¹æ¡ˆï¼šæ··åˆæƒé‡æ–¹æ¡ˆ

ç»“åˆä»¥ä¸Šæ–¹æ¡ˆçš„ä¼˜ç‚¹ï¼Œæ¨èä½¿ç”¨**æ··åˆæƒé‡æ–¹æ¡ˆ**ï¼š

### 4.1 å®Œæ•´è®¡ç®—æµç¨‹

```javascript
function matchByScoreWithSpecialRequirements(uni, userScores) {
    // 1. è§£æç‰¹æ®Šè¦æ±‚
    const specialReqs = parseSpecialRequirements(uni.specialRequirements || '');
    
    // 2. ç¡¬æ€§æ¡ä»¶æ£€æŸ¥
    const checkResult = checkSpecialRequirements(userScores, specialReqs);
    if (!checkResult.passed) {
        return {
            ...uni,
            matchStatus: 'blocked',  // ä¸ç¬¦åˆæ¡ä»¶
            scoreEffect: 0,
            blockedReason: `ä¸æ»¡è¶³ç‰¹æ®Šè¦æ±‚ï¼š${checkResult.failedSubjects.map(f => `${f.subject}éœ€è¦â‰¥${f.required}åˆ†ï¼ˆå½“å‰${f.actual}åˆ†ï¼‰`).join('ï¼Œ')}`,
            failedRequirements: checkResult.failedSubjects
        };
    }
    
    // 3. è·å–éœ€è¦çš„ç§‘ç›®å’Œå‚è€ƒåˆ†æ•°
    const requiredSubjects = getRequiredSubjects(uni);
    const thresholds = {};
    for (const subject of requiredSubjects) {
        thresholds[subject] = getThreshold(uni, subject);
    }
    
    // 4. è®¡ç®—åŠ æƒåŒ¹é…åº¦
    const scoreEffect = calculateWeightedScoreEffect(
        userScores, 
        requiredSubjects, 
        thresholds, 
        specialReqs
    );
    
    // 5. åˆ†ç±»åˆ¤å®š
    let status = 'reach';
    if (scoreEffect >= 1.05) {
        status = 'pass';      // âœ… åˆæ ¼åœ
    } else if (scoreEffect >= 0.95 && scoreEffect < 1.05) {
        status = 'close';    // âš ï¸ æ¥è¿‘åœ
    }
    
    return {
        ...uni,
        matchStatus: status,
        scoreEffect: scoreEffect,
        hasSpecialRequirements: Object.keys(specialReqs).length > 0,
        specialRequirements: specialReqs
    };
}
```

### 4.2 æƒé‡è®¡ç®—å…¬å¼ï¼ˆè¯¦ç»†ç‰ˆï¼‰

```javascript
function calculateWeightedScoreEffect(userScores, requiredSubjects, thresholds, specialReqs) {
    const subjectData = [];
    
    // æ”¶é›†æ‰€æœ‰ç§‘ç›®çš„æ•°æ®
    for (const subject of requiredSubjects) {
        const userScore = getUserScoreForSubject(userScores, subject);
        const threshold = thresholds[subject];
        
        if (!threshold || threshold <= 0) continue;
        
        const ratio = userScore / threshold;
        const hasSpecialReq = !!specialReqs[subject];
        
        // æƒé‡ï¼šæœ‰ç‰¹æ®Šè¦æ±‚ = 2.0ï¼Œæ— ç‰¹æ®Šè¦æ±‚ = 1.0
        const weight = hasSpecialReq ? 2.0 : 1.0;
        
        subjectData.push({
            subject: subject,
            ratio: ratio,
            weight: weight,
            hasSpecialReq: hasSpecialReq
        });
    }
    
    if (subjectData.length === 0) return 0;
    
    // è®¡ç®—åŠ æƒç®—æœ¯å¹³å‡
    const weightedSum = subjectData.reduce((sum, d) => sum + d.ratio * d.weight, 0);
    const totalWeight = subjectData.reduce((sum, d) => sum + d.weight, 0);
    const weightedMean = weightedSum / totalWeight;
    
    // è®¡ç®—æœ€å°å€¼ï¼ˆçŸ­æ¿ï¼‰
    const minRatio = Math.min(...subjectData.map(d => d.ratio));
    
    // æ··åˆè®¡ç®—ï¼šå¦‚æœæœ‰ç‰¹æ®Šè¦æ±‚ï¼Œæ›´åå‘æœ€å°å€¼ï¼›å¦åˆ™å¹³è¡¡
    const hasAnySpecialReq = subjectData.some(d => d.hasSpecialReq);
    const alpha = hasAnySpecialReq ? 0.7 : 0.5;  // æœ‰ç‰¹æ®Šè¦æ±‚æ—¶ï¼Œ70%æƒé‡ç»™æœ€å°å€¼
    
    const scoreEffect = minRatio * alpha + weightedMean * (1 - alpha);
    
    return Math.min(Math.max(scoreEffect, 0), 2);
}
```

---

## ğŸ¨ äº”ã€çŠ¶æ€åˆ†ç±»

### 5.1 æ–°å¢çŠ¶æ€ï¼š`blocked`ï¼ˆä¸ç¬¦åˆæ¡ä»¶ï¼‰

```javascript
// çŠ¶æ€å®šä¹‰
const STATUS = {
    PASS: 'pass',        // âœ… åˆæ ¼åœï¼šscoreEffect >= 1.05
    CLOSE: 'close',      // âš ï¸ æ¥è¿‘åœï¼š0.95 <= scoreEffect < 1.05
    REACH: 'reach',      // ğŸ‘€ è§‚æœ›åœï¼šscoreEffect < 0.95
    BLOCKED: 'blocked'   // ğŸš« ä¸ç¬¦åˆæ¡ä»¶ï¼šä¸æ»¡è¶³ç‰¹æ®Šè¦æ±‚
};
```

### 5.2 æ˜¾ç¤ºé€»è¾‘

```javascript
function getStatusDisplay(status, blockedReason) {
    switch (status) {
        case 'pass':
            return { 
                label: 'åˆæ ¼åœ', 
                icon: 'âœ…', 
                color: 'green',
                description: 'è¶…è¿‡å‚è€ƒåˆ†æ•°5%ä»¥ä¸Š'
            };
        case 'close':
            return { 
                label: 'æ¥è¿‘åœ', 
                icon: 'âš ï¸', 
                color: 'yellow',
                description: 'åœ¨å‚è€ƒåˆ†æ•°Â±5%èŒƒå›´å†…'
            };
        case 'reach':
            return { 
                label: 'è§‚æœ›åœ', 
                icon: 'ğŸ‘€', 
                color: 'orange',
                description: 'ä½äºå‚è€ƒåˆ†æ•°5%ä»¥ä¸Š'
            };
        case 'blocked':
            return { 
                label: 'ä¸ç¬¦åˆæ¡ä»¶', 
                icon: 'ğŸš«', 
                color: 'red',
                description: blockedReason || 'ä¸æ»¡è¶³ç‰¹æ®Šæˆç»©è¦æ±‚'
            };
        default:
            return { 
                label: 'æœªçŸ¥', 
                icon: 'â“', 
                color: 'gray',
                description: ''
            };
    }
}
```

---

## ğŸ“ˆ å…­ã€ç¤ºä¾‹è®¡ç®—

### ç¤ºä¾‹1ï¼šæœ‰ç‰¹æ®Šè¦æ±‚çš„å¤§å­¦

**åœºæ™¯**ï¼šæ—©ç¨²ç”°å¤§å­¦ äººé–“ç§‘å­¦å­¦éƒ¨
- ç‰¹æ®Šè¦æ±‚ï¼š`æ•°å­¦1:150`
- ç”¨æˆ·æˆç»©ï¼šæ•°å­¦1 = 140åˆ†ï¼Œæ—¥è¯­ = 350åˆ†ï¼Œç»¼åˆ = 180åˆ†
- å‚è€ƒåˆ†æ•°ï¼šæ•°å­¦1 = 130åˆ†ï¼ˆp50ï¼‰ï¼Œæ—¥è¯­ = 320åˆ†ï¼Œç»¼åˆ = 170åˆ†

**è®¡ç®—è¿‡ç¨‹**ï¼š
1. **ç¡¬æ€§æ¡ä»¶æ£€æŸ¥**ï¼šæ•°å­¦1 = 140 < 150 âŒ â†’ **ä¸ç¬¦åˆæ¡ä»¶** â†’ çŠ¶æ€ = `blocked`

**ç»“æœ**ï¼šè¯¥å¤§å­¦ä¸æ˜¾ç¤ºåœ¨åŒ¹é…ç»“æœä¸­ï¼Œæˆ–æ˜¾ç¤ºä¸º"ä¸ç¬¦åˆæ¡ä»¶"ã€‚

---

### ç¤ºä¾‹2ï¼šæ»¡è¶³ç‰¹æ®Šè¦æ±‚ï¼Œè®¡ç®—åŠ æƒåŒ¹é…åº¦

**åœºæ™¯**ï¼šæ—©ç¨²ç”°å¤§å­¦ äººé–“ç§‘å­¦å­¦éƒ¨
- ç‰¹æ®Šè¦æ±‚ï¼š`æ•°å­¦1:150`
- ç”¨æˆ·æˆç»©ï¼šæ•°å­¦1 = 160åˆ†ï¼Œæ—¥è¯­ = 350åˆ†ï¼Œç»¼åˆ = 180åˆ†
- å‚è€ƒåˆ†æ•°ï¼šæ•°å­¦1 = 130åˆ†ï¼ˆp50ï¼‰ï¼Œæ—¥è¯­ = 320åˆ†ï¼Œç»¼åˆ = 170åˆ†

**è®¡ç®—è¿‡ç¨‹**ï¼š
1. **ç¡¬æ€§æ¡ä»¶æ£€æŸ¥**ï¼šæ•°å­¦1 = 160 â‰¥ 150 âœ… â†’ é€šè¿‡
2. **è®¡ç®—è¾¾æˆç‡**ï¼š
   - æ•°å­¦1ï¼š160 / 130 = 1.23ï¼ˆæƒé‡ = 2.0ï¼Œæœ‰ç‰¹æ®Šè¦æ±‚ï¼‰
   - æ—¥è¯­ï¼š350 / 320 = 1.09ï¼ˆæƒé‡ = 1.0ï¼‰
   - ç»¼åˆï¼š180 / 170 = 1.06ï¼ˆæƒé‡ = 1.0ï¼‰
3. **åŠ æƒè®¡ç®—**ï¼š
   - åŠ æƒå¹³å‡ = (1.23Ã—2.0 + 1.09Ã—1.0 + 1.06Ã—1.0) / (2.0+1.0+1.0) = 4.61 / 4.0 = 1.15
   - æœ€å°å€¼ = min(1.23, 1.09, 1.06) = 1.06
   - æ··åˆå€¼ = 1.06 Ã— 0.7 + 1.15 Ã— 0.3 = 1.09
4. **åˆ†ç±»**ï¼šscoreEffect = 1.09 â‰¥ 1.05 â†’ **åˆæ ¼åœ**

**ç»“æœ**ï¼šçŠ¶æ€ = `pass`ï¼ŒåŒ¹é…åº¦ = 109%

---

### ç¤ºä¾‹3ï¼šæ— ç‰¹æ®Šè¦æ±‚çš„å¤§å­¦ï¼ˆä¿æŒåŸé€»è¾‘ï¼‰

**åœºæ™¯**ï¼šæŸå¤§å­¦ æŸå­¦éƒ¨
- ç‰¹æ®Šè¦æ±‚ï¼šæ— 
- ç”¨æˆ·æˆç»©ï¼šæ•°å­¦1 = 140åˆ†ï¼Œæ—¥è¯­ = 350åˆ†ï¼Œç»¼åˆ = 180åˆ†
- å‚è€ƒåˆ†æ•°ï¼šæ•°å­¦1 = 130åˆ†ï¼Œæ—¥è¯­ = 320åˆ†ï¼Œç»¼åˆ = 170åˆ†

**è®¡ç®—è¿‡ç¨‹**ï¼š
1. **ç¡¬æ€§æ¡ä»¶æ£€æŸ¥**ï¼šæ— ç‰¹æ®Šè¦æ±‚ â†’ è·³è¿‡
2. **è®¡ç®—è¾¾æˆç‡**ï¼š
   - æ•°å­¦1ï¼š140 / 130 = 1.08ï¼ˆæƒé‡ = 1.0ï¼‰
   - æ—¥è¯­ï¼š350 / 320 = 1.09ï¼ˆæƒé‡ = 1.0ï¼‰
   - ç»¼åˆï¼š180 / 170 = 1.06ï¼ˆæƒé‡ = 1.0ï¼‰
3. **åŠ æƒè®¡ç®—**ï¼ˆæ— ç‰¹æ®Šè¦æ±‚ï¼Œalpha = 0.5ï¼‰ï¼š
   - åŠ æƒå¹³å‡ = (1.08 + 1.09 + 1.06) / 3 = 1.08
   - æœ€å°å€¼ = 1.06
   - æ··åˆå€¼ = 1.06 Ã— 0.5 + 1.08 Ã— 0.5 = 1.07
4. **åˆ†ç±»**ï¼šscoreEffect = 1.07 â‰¥ 1.05 â†’ **åˆæ ¼åœ**

**ç»“æœ**ï¼šçŠ¶æ€ = `pass`ï¼ŒåŒ¹é…åº¦ = 107%

---

## ğŸ”„ ä¸ƒã€å®ç°æ­¥éª¤

### æ­¥éª¤1ï¼šæ·»åŠ è§£æå‡½æ•°
åœ¨ `compass_score.html` ä¸­æ·»åŠ  `parseSpecialRequirements()` å’Œ `checkSpecialRequirements()` å‡½æ•°ã€‚

### æ­¥éª¤2ï¼šä¿®æ”¹åŒ¹é…å‡½æ•°
ä¿®æ”¹ `matchByScore()` å‡½æ•°ï¼Œé›†æˆç‰¹æ®Šè¦æ±‚æ£€æŸ¥ã€‚

### æ­¥éª¤3ï¼šæ·»åŠ åŠ æƒè®¡ç®—
å®ç° `calculateWeightedScoreEffect()` å‡½æ•°ã€‚

### æ­¥éª¤4ï¼šæ›´æ–°æ˜¾ç¤ºé€»è¾‘
- æ·»åŠ  `blocked` çŠ¶æ€çš„æ˜¾ç¤ºæ ·å¼
- æ˜¾ç¤ºä¸ç¬¦åˆæ¡ä»¶çš„åŸå› 
- åœ¨ç»“æœä¸­æ ‡æ³¨æœ‰ç‰¹æ®Šè¦æ±‚çš„å¤§å­¦

### æ­¥éª¤5ï¼šæµ‹è¯•éªŒè¯
- æµ‹è¯•æœ‰ç‰¹æ®Šè¦æ±‚çš„å¤§å­¦
- æµ‹è¯•æ— ç‰¹æ®Šè¦æ±‚çš„å¤§å­¦ï¼ˆç¡®ä¿å‘åå…¼å®¹ï¼‰
- æµ‹è¯•è¾¹ç•Œæƒ…å†µï¼ˆå¤šä¸ªç‰¹æ®Šè¦æ±‚ã€éƒ¨åˆ†æ»¡è¶³ç­‰ï¼‰

---

## ğŸ’¡ å…«ã€æ–¹æ¡ˆä¼˜åŠ¿

1. **ç¡¬æ€§æ¡ä»¶ä¼˜å…ˆ**ï¼šä¸æ»¡è¶³ç‰¹æ®Šè¦æ±‚çš„ç›´æ¥æ’é™¤ï¼Œç¬¦åˆå®é™…å½•å–æµç¨‹
2. **æƒé‡å·®å¼‚åŒ–**ï¼šæœ‰ç‰¹æ®Šè¦æ±‚çš„ç§‘ç›®æƒé‡æ›´é«˜ï¼Œæ›´ç¬¦åˆé‡è¦æ€§
3. **å‘åå…¼å®¹**ï¼šæ— ç‰¹æ®Šè¦æ±‚çš„å¤§å­¦ä¿æŒåŸæœ‰é€»è¾‘
4. **çµæ´»æ‰©å±•**ï¼šæ˜“äºæ·»åŠ æ–°çš„ç‰¹æ®Šè¦æ±‚ç±»å‹
5. **ç”¨æˆ·å‹å¥½**ï¼šæ˜ç¡®æ˜¾ç¤ºä¸ç¬¦åˆæ¡ä»¶çš„åŸå› ï¼Œå¸®åŠ©ç”¨æˆ·äº†è§£å·®è·

---

## â“ ä¹ã€å¾…è®¨è®ºé—®é¢˜

1. **æƒé‡æ¯”ä¾‹**ï¼šæœ‰ç‰¹æ®Šè¦æ±‚çš„ç§‘ç›®æƒé‡è®¾ä¸º2.0æ˜¯å¦åˆé€‚ï¼Ÿæ˜¯å¦éœ€è¦å¯é…ç½®ï¼Ÿ
2. **æ··åˆç³»æ•°**ï¼šalphaå€¼ï¼ˆ0.7 vs 0.5ï¼‰æ˜¯å¦éœ€è¦è°ƒæ•´ï¼Ÿ
3. **æ˜¾ç¤ºæ–¹å¼**ï¼š`blocked` çŠ¶æ€çš„å¤§å­¦æ˜¯å¦æ˜¾ç¤ºåœ¨ç»“æœä¸­ï¼Ÿè¿˜æ˜¯å®Œå…¨éšè—ï¼Ÿ
4. **éƒ¨åˆ†æ»¡è¶³**ï¼šå¦‚æœå¤šä¸ªç‰¹æ®Šè¦æ±‚ä¸­ï¼Œéƒ¨åˆ†æ»¡è¶³ã€éƒ¨åˆ†ä¸æ»¡è¶³ï¼Œå¦‚ä½•å¤„ç†ï¼Ÿ
5. **ç‰¹æ®Šè¦æ±‚ä¼˜å…ˆçº§**ï¼šå¦‚æœæŸä¸ªç§‘ç›®æ—¢æœ‰ç‰¹æ®Šè¦æ±‚ï¼Œåˆæœ‰å¾ˆé«˜çš„å‚è€ƒåˆ†æ•°ï¼Œå¦‚ä½•å¹³è¡¡ï¼Ÿ

---

*æœ€åæ›´æ–°ï¼š2025-02-12*
