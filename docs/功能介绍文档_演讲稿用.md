# JI-日本留学ナビ · 功能介绍文档（演讲稿用）

> 本文档面向「与另一 AI 共同拟定演讲稿」场景，对系统内所有功能做完整、可逐条讲解的说明，便于演讲时逐项解释与演示。

---

## 一、项目定位与背景

### 1.1 项目名称与描述

- **项目名**：ichikawaryuugaku（市川留学） / **JI-日本留学ナビ**
- **一句话**：日本留学申请综合管理平台，以**出愿计划管理**为核心，通过条件检索、成绩匹配、关键词搜索三种方式帮助学生找到匹配学校，并统一管理申请流程与时间节点。

### 1.2 解决的痛点

1. **信息查找困难**：学生需从数百所大学、数千个学部中筛选，信息分散在多个 Excel 中。
2. **匹配效率低**：老师需根据学生成绩手动查表，一个学生可能花费数小时。
3. **计划管理混乱**：出愿时间、校内考时间等关键节点容易遗漏，导致错过申请。
4. **数据更新繁琐**：每年招生信息更新需手动维护多表，易出错。

### 1.3 核心设计理念

- **核心功能**：出愿计划管理（统一管理所有申请计划）。
- **三种添加学校方式**：条件检索、成绩匹配、关键词搜索。
- **辅助功能**：时间轴规划（可视化时间管理）。
- **支撑功能**：数据分析、管理员后台（数据与系统维护）。

---

## 二、用户角色与入口

### 2.1 用户类型

| 角色     | 说明                     | 主要入口                         |
|----------|--------------------------|----------------------------------|
| 学生     | 准备申请日本大学的学生   | 首页 → 出愿中心 / 成绩匹配等     |
| 老师/顾问| 指导学生申请的顾问       | 同上，代学生使用计划与匹配       |
| 管理员   | 维护系统数据与用户       | `/admin/login.html` 后台登录     |

### 2.2 前台入口与导航

- **首页**：`index.html` — 展示平台名称、模块卡片（出愿中心、成绩匹配、条件筛选、快速搜索、数据分析等），点击进入对应功能。
- **compass 系列页面**：出愿中心、成绩匹配、条件筛选、快速搜索、数据分析、各大学分数要求等，风格统一（毛玻璃、日文字体、渐变背景）。

### 2.3 后台入口

- **管理员登录**：`/admin/login.html`，使用已设为管理员的账号（通过 `scripts/set-admin.js` 或数据库设置 `role='admin'`）。
- **首次设置**：执行 `npm run migrate-admin`，再用 `node scripts/set-admin.js 用户名` 指定管理员。

---

## 三、核心功能详解

### 3.1 出愿计划管理（主功能）

**页面**：`compass_application.html`（出愿センター）

**解决的问题**：

- 每所学校出愿时间、校内考时间不同，易遗漏关键节点。
- 计划分散在多处，难以统一查看与跟进进度。

**功能要点**：

1. **统一管理**：所有申请计划集中在一个界面，按学校/学部列表展示。
2. **关键时间节点**：展示每所学校的网上出愿时间、邮寄截止、校内考时间、发榜时间等（数据来自学校总览）。
3. **进度与备注**：可记录每个申请的进度、状态与备注。
4. **时间轴视图**：根据计划中的学校自动生成「全体时间轴」，区分过去/未来，可折叠过去事项。
5. **添加学校**：通过三种方式（条件检索、成绩匹配、关键词搜索）将学校加入计划，加入后即纳入时间轴与列表。

**数据来源**：用户个人计划存于 PostgreSQL（`plan_items` 等）；学校基础信息来自 `school-master.json`（由 `学部学校一览表.xlsx` 导出）。

**演讲时可强调**：出愿计划是整系统的中心，其他功能都是「为计划添加学校」或「为计划提供数据支撑」。

---

### 3.2 添加学校方式一：条件检索

**页面**：`compass_filter.html`（条件筛选）

**定位**：当学生有明确条件（地区、文理、出愿方式等）时，用条件筛选学校并加入出愿计划。

**功能要点**：

- **可筛维度**：地区（位置）、文理、选考方式（方式）、期数（第几期）、是否可併願、EJU 使用时期、是否需要英语/JLPT、校内考形式等。
- **结果展示**：以学校/学部为单元展示，可展开查看详情；支持「加入出愿计划」。
- **数据依据**：使用 `school-master.json` 中 `region`、`bunri`、`selectionMethod`、`period`、`combined`、`english`、`jlpt`、`examFormat` 等字段。

**与计划的关系**：筛选出学校后，一键添加到当前用户的出愿计划，随后在 `compass_application.html` 中统一管理与展示时间轴。

---

### 3.3 添加学校方式二：成绩智能匹配

**页面**：`compass_score.html`（成绩匹配）

**定位**：根据学生各科成绩，自动匹配「合格圏」「接近圏」「观望圏」学校，是系统最具差异化的功能。

**流程概述**：

1. **用户输入**：选择文理 → 选择 EJU 科目组合（如文科：日语+数学1+综合+托福）→ 输入各科分数（日语、数学1/2、综合、物化生、托福等）。
2. **匹配逻辑**：
   - 从 `data/admission_score_model.json` 获取各校各学部各科的参考分（以 p50 中位数为准，无则用 min）。
   - 若某校在模型中无数据，则回退到 `school-master.json` 的 `recommendJP` / `recommendEN` 或默认值（日语 300、托福 80）。
   - 按「学校所需科目」计算每科达成率（用户分数/参考分），再取**最小达成率**作为匹配度（短板原理）。
3. **分类规则**（多科）：
   - 匹配度 ≥ 1.05 → **合格圏**
   - 0.95 ≤ 匹配度 < 1.05 → **接近圏**
   - 匹配度 < 0.95 → **观望圏**
   - 单科匹配时采用更严标准（如 1.10/1.00 为界），详见 `docs/单科匹配特殊情况处理方案.md`。
4. **特殊成绩要求**：若学校在 `school-master.json` 中有 `specialRequirements`（格式如 `数学1:150,日语:300`），先校验是否满足，不满足则标记为「未满足最低要求」等，不参与上述三档分类。
5. **结果展示**：列表显示学校、学部、匹配状态、参考分、与参考分的差距等；可一键加入出愿计划。

**数据来源**：`admission_score_model.json` 由 `scripts/analyze_admission_scores.py` 从 `合格实绩.xlsx` 分析生成（按大学·学部·文理分组，加权分位数 p50 等）；`合格实绩.xlsx` 需含 2024 文科/理科、2023、2022 等工作表及结果/大学/学部/文理/各科分数等列。

**演讲时可强调**：从「老师凭经验查表 2–3 小时」变为「输入成绩后 5–10 分钟得到基于真实合格数据的匹配结果」，并可直接加入出愿计划。

---

### 3.4 添加学校方式三：关键词搜索

**页面**：`compass_search.html`（クイック検索）

**定位**：学生已知学校名或学部名时，快速搜到并加入计划。

**功能要点**：

- 输入学校名、学部名等关键词，实时搜索 `school-master.json`。
- 结果列表展示匹配的学校·学部，可查看详情并「加入出愿计划」。

---

### 3.5 时间轴规划（辅助功能）

**位置**：嵌入在 `compass_application.html` 中，作为出愿计划的辅助视图。

**功能要点**：

- 根据**当前出愿计划中的学校**自动生成一条时间轴。
- 展示关键阶段：语言考试准备、出愿材料准备、各校出愿时间、校内考时间、发榜时间、入学准备等。
- 支持「过去 / 未来」分区，过去事项可折叠，便于聚焦即将到来的节点。

**数据来源**：计划内学校的 `mailStart`、`mailEnd`、`examDate`、`examDate2`、`announcementDate` 等来自学校总览。

---

### 3.6 数据分析（支撑功能）

**页面**：`compass_analytics.html`（データ分析）

**定位**：为选校与成绩匹配提供历史数据参考，不直接「添加学校」，但帮助判断哪些学校更适合加入计划。

**功能要点**：

- 基于合格实绩分析结果（与成绩匹配同源），展示各校各学部的成绩统计。
- 可含图表（Chart.js）、分数区间、样本数等，便于了解录取难度与趋势。

**数据来源**：`data/admission_score_model.json`（与成绩匹配一致）。

---

### 3.7 各大学分数要求说明页（支撑功能）

**页面**：`compass_score_guide.html`（各大学分数要求）

**定位**：集中展示「各校各学部各科参考分」，方便不输入成绩时浏览各校要求。

**功能要点**：

- 按学校、学部、文理展开，列出日语、数学1/2、综合、物化生、托福等科目的参考分（p50）及样本数。
- 说明数据来自 `合格实绩.xlsx` → `analyze_admission_scores.py` → `admission_score_model.json`。
- 提供「分数计算方式」等可折叠说明，便于演讲时解释算法。

---

## 四、管理员后台（支撑功能）

**入口**：`/admin/login.html`，需管理员账号。

**主要能力**（见 `routes/admin.js`）：

1. **数据概览**：`/api/admin/dashboard` — 用户数、学校数、计划条目数、今日新增等。
2. **学校总览数据更新**：
   - 上传 Excel（与 `学部学校一览表.xlsx` 格式一致），后端解析并生成 `学校总览.json` / `school-master.json`、`学校总览.csv`。
   - 自动备份旧文件到 `backups/`，并写操作日志（`operation_logs`）。
3. **用户管理**：查看用户、管理权限、查看活动等（依实际实现的接口为准）。
4. **操作日志**：记录管理员登录、数据更新等操作，便于审计。

**说明**：合格实绩数据（`admission_score_model.json`）当前需在本地运行 `python3 scripts/analyze_admission_scores.py` 更新；文档中已规划「后台直接上传合格实绩 Excel 并生成模型」的改进（见 `docs/数据更新操作指南.md`）。

---

## 五、数据架构与来源（便于演讲时解释「数据从哪来」）

### 5.1 混合存储

- **PostgreSQL**：用户账号、个人学校列表、出愿计划、管理员与操作日志等**动态与用户相关**数据。
- **JSON/CSV 文件**：**静态业务数据**，供前端或 API 读取：
  - `school-master.json` / `学校总览.json`：学校总览（由 `学部学校一览表.xlsx` 导出）。
  - `学校总览.csv`：同上，CSV 版。
  - `data/admission_score_model.json`：合格实绩分析结果（由 `合格实绩.xlsx` 分析得到）。

### 5.2 学校总览数据流

- **源**：`学部学校一览表.xlsx`（表名如「学校总览」）。
- **列映射**（部分）：大学→name、学部→department、学科→major、位置→region、文理→bunri、方式→selectionMethod、第几期→period、併願→combined、EJU/英语/JLPT、网上出愿开始/截止、邮寄开始/截止、校内考形式/时间、发榜时间、**特殊成绩要求→specialRequirements** 等（详见 `docs/数据对应关系说明.md`、`routes/admin.js` 的 COLUMN_MAP）。
- **生成方式**：后台上传 Excel 后由 Node 解析并写 JSON/CSV；或本地运行 `python3 export_school_data.py`。
- **使用处**：条件筛选、关键词搜索、出愿计划中的学校信息与时间轴、成绩匹配的回退推荐分等。

### 5.3 合格实绩分析数据流

- **源**：`合格实绩.xlsx`，工作表如 `2024文科`、`2024理科`、`2023`、`2022`；列含结果、大学、学部、文理、日语、数学1、数学2、综合、物理、化学、生物、托福等（支持多种列名别名）。
- **处理**：仅保留「合格」样本；按（大学、学部、文理）分组；按年份加权（2024=1.0，2023=0.8，2022=0.6）计算加权分位数 min/p25/p50/p75 与样本数 n；大学名规范化（繁简、括号等）。
- **脚本**：`scripts/analyze_admission_scores.py`。
- **输出**：`data/admission_score_model.json`，结构为 `bunka`/`rika` → 大学名 → 学部名 → `subjects`（各科 min/p25/p50/p75/n）。
- **使用处**：成绩匹配的参考分（以 p50 为主）、各大学分数要求页、数据分析页。

### 5.4 特殊成绩要求与最低分数

- **特殊成绩要求**：在 Excel 中单列「特殊成绩要求」，格式为 `科目名:分数`，多科用逗号分隔（如 `数学1:150,日语:300`）。导出到 `school-master.json` 的 `specialRequirements`。成绩匹配前先校验，不满足则标记为未满足要求（见 `docs/特殊成绩要求数据结构设计.md`、`docs/飞书表格特殊成绩要求填写指南.md`）。
- **最低分数要求**（若实现）：可在 Excel 中为每科设独立最低分列（如最低日语分数、最低数学1分数等），用于硬性门槛校验（见 `docs/最低分数要求数据结构设计.md`）。

---

## 六、技术栈与接口（便于技术向演讲或答疑）

- **后端**：Node.js + Express，端口默认 3000。
- **数据库**：PostgreSQL（用户、计划、日志等），连接串来自 `DATABASE_URL`。
- **认证**：JWT（含管理员），密码 bcrypt；管理员路由受 `requireAdmin` 保护。
- **主要 API**：
  - `GET /api/school-master`：返回学校总览 JSON（供前端筛选/搜索/计划/成绩回退）。
  - `/api/auth`：登录、注册等。
  - `/api/schools`、`/api/plan`：个人学校列表、出愿计划 CRUD。
  - `/api/admin/*`：管理员登录、dashboard、上传学校总览 Excel、日志等。
- **前端**：静态 HTML + Tailwind CSS + 原生 JS，部分页面用 Chart.js；字体 Noto Sans JP / Noto Serif JP 等。
- **部署**：可部署至 Render 等（见 `render.yaml`），启动前将 `学校总览.json` 复制为 `school-master.json` 以兼容无中文文件名环境。

---

## 七、脚本与文档索引（便于说明「运维与扩展」）

### 7.1 数据相关脚本

- `export_school_data.py`：从 Excel 导出学校总览 → `学校总览.json`、`school-master.json`、`学校总览.csv`。
- `scripts/analyze_admission_scores.py`：从 `合格实绩.xlsx` 生成 `data/admission_score_model.json`。
- `scripts/analyze_period_data.py`、`scripts/analyze_selection_method_data.py`：期数、选考方式分类分析，输出到 `standardization/` 及分析结果总结。

### 7.2 爬虫与标准化（规划/进行中）

- `scripts/crawlers/unified_crawler_framework.py`、`crawl_classification_info.py`、`simple_crawl_classification.py`：爬取大学官网招生信息，用于期数、选考方式等分类标准化（见 `docs/当前状态和下一步计划.md`、`docs/爬取分类信息实施方案.md`）。
- `crawled_data/`：URL 模板、审核表格等爬取相关数据。

### 7.3 管理员与数据库

- `scripts/set-admin.js`：将指定用户设为管理员。
- `scripts/migrate-admin.js`：管理员相关数据库迁移。
- `scripts/init-db.js`：数据库初始化。

### 7.4 重要文档（可作演讲附录或 Q&A 依据）

- **数据与模型**：`data/README.md`、`docs/数据对应关系说明.md`、`docs/计算模型和数据架构说明.md`。
- **成绩与匹配**：`docs/最低分数要求数据结构设计.md`、`docs/特殊成绩要求数据结构设计.md`、`docs/单科匹配特殊情况处理方案.md`、`docs/特殊成绩要求计算模型设计方案.md`、`docs/飞书表格特殊成绩要求填写指南.md`。
- **分类与爬取**：`docs/期数分类标准.md`、`docs/选考方式分类标准.md`、`docs/数据分析结果总结.md`、`docs/当前状态和下一步计划.md`、`docs/爬取分类信息实施方案.md`。
- **运维与后台**：`docs/数据更新操作指南.md`、`docs/ADMIN_QUICKSTART.md`。
- **演示与汇报**：`docs/演示解说词.md`（含开场、功能演示顺序、技术保障、后续计划、领导 Q&A 参考）。

---

## 八、后续计划与可讲亮点（来自现有文档）

- **短期**：合格实绩数据改为后台上传并生成模型；支持特殊成绩要求在匹配中的完整应用；移动端优化。
- **中期**：飞书表格等外部数据源接入；更丰富的分析（趋势、对比、预测）；个性化推荐。
- **长期**：AI 智能推荐、多语言支持、数据可视化升级等。

**演讲时可强调的价值**：效率（单生匹配从 2–3 小时到 5–10 分钟）、数据驱动（合格实绩 + 加权统计）、可追溯（操作日志与备份）、可扩展（爬虫与分类标准化为后续数据质量打基础）。

---

## 九、演讲稿拟定建议

1. **按模块讲**：先总览（定位、痛点、核心架构），再按「出愿计划 → 三种添加方式（条件/成绩/搜索）→ 时间轴 → 数据分析与分数要求 → 管理员后台」顺序讲，每块可对应「功能 → 数据从哪来 → 对用户/老师的价值」。
2. **演示顺序**：登录 → 出愿中心（空计划）→ 用「成绩匹配」加入几所学校 → 回到出愿中心展示列表与时间轴 → 再用条件筛选、关键词搜索各加一所 → 最后可简短展示数据分析、各大学分数要求、管理员上传学校总览（若需要）。
3. **技术/数据问题**：可直接引用本文「五、数据架构」「六、技术栈」「七、脚本与文档」和 `docs/演示解说词.md` 中的 Q&A，保证口径一致。
4. **与另一 AI 协作时**：可将本文档作为「功能清单与说明」输入，请其生成逐字稿、时间分配或每页 PPT 的讲解要点，并标注「可演示点击路径」与「可省略的技术细节」。

---

*文档版本：基于项目现有文件与 docs 整理，适用于 2025 年 2 月后的演讲稿拟定与功能宣讲。*
