# 数据更新总结与操作指南

## 📊 当前情况总结

### ✅ 已实现的功能

**学校总览数据更新**：
- ✅ 管理者后台已支持上传 Excel 文件更新
- ✅ 自动备份旧数据
- ✅ 操作简单，无需技术背景

### ⚠️ 需要改进的功能

**合格实绩数据更新**：
- ❌ 目前需要手动运行 Python 脚本
- ❌ 需要服务器访问权限
- ❌ 操作复杂，需要技术背景

---

## 🎯 回答您的问题

### Q1: 每次更新时，是否只需要上传编辑完的文件就好了？

**答案：部分是的**

#### 学校总览数据 ✅
- **是的**，只需要在后台上传编辑完的 Excel 文件即可
- 系统会自动处理、备份和更新

#### 合格实绩数据 ❌
- **不是**，目前需要：
  1. 编辑 Excel 文件
  2. 在本地运行 Python 脚本
  3. 将生成的 JSON 文件上传到服务器

---

### Q2: 是否需要加强管理者后台的更新数据功能？

**答案：强烈建议加强**

**当前问题**：
- 合格实绩数据更新流程复杂
- 需要技术人员操作
- 容易出错

**建议增强**：
- 在后台添加「合格实绩数据更新」功能
- 与学校总览更新类似，支持直接上传 Excel
- 系统自动运行分析算法并生成 JSON
- 自动备份旧数据

---

## 📝 当前操作步骤（每次更新时）

### 场景：年度数据更新

#### 步骤 1：更新学校总览数据（✅ 简单）

1. **准备文件**：编辑 `学部学校一览表.xlsx`
2. **登录后台**：访问 `/admin/login.html`
3. **上传文件**：
   - 点击「数据库更新」菜单
   - 在「学校总览更新」区域上传 Excel 文件
4. **确认结果**：查看更新成功提示和备份信息

**耗时**：约 2-3 分钟

---

#### 步骤 2：更新合格实绩数据（⚠️ 复杂）

**方式 A：当前方式（需要技术操作）**

1. **准备文件**：编辑 `合格实绩.xlsx`
2. **运行脚本**（需要本地环境）：
   ```bash
   python3 scripts/analyze_admission_scores.py
   ```
3. **上传文件**：将生成的 `data/admission_score_model.json` 上传到服务器
4. **验证**：检查前端是否正常显示

**耗时**：约 10-15 分钟（包括环境准备）

**方式 B：推荐方式（增强后台后）**

1. **准备文件**：编辑 `合格实绩.xlsx`
2. **登录后台**：访问 `/admin/login.html`
3. **上传文件**：
   - 点击「数据库更新」菜单
   - 在「合格实绩更新」区域上传 Excel 文件
4. **确认结果**：查看更新成功提示和统计信息

**耗时**：约 2-3 分钟

---

## 🚀 推荐的操作流程（增强后台后）

### 完整更新流程

1. **准备数据文件**
   - 更新 `学部学校一览表.xlsx`
   - 更新 `合格实绩.xlsx`

2. **登录管理者后台**
   - 访问 `/admin/login.html`
   - 使用管理员账号登录

3. **更新学校总览数据**
   - 进入「数据库更新」页面
   - 上传 `学部学校一览表.xlsx`
   - 等待处理完成

4. **更新合格实绩数据**（增强后）
   - 在同一页面
   - 上传 `合格实绩.xlsx`
   - 等待处理完成（系统自动运行分析算法）

5. **验证更新**
   - 检查前端页面数据
   - 测试成绩匹配功能

**总耗时**：约 5-10 分钟（无需技术背景）

---

## 💡 具体建议

### 短期方案（当前可用）

**学校总览数据**：
- ✅ 直接使用后台上传功能
- ✅ 操作简单，推荐使用

**合格实绩数据**：
- ⚠️ 需要技术人员操作
- ⚠️ 建议固定一个技术人员负责更新
- ⚠️ 建立操作文档和检查清单

---

### 长期方案（推荐实现）

**增强后台功能**：
1. 添加「合格实绩数据更新」上传功能
2. 后端实现 Excel 解析和统计分析
3. 自动备份和版本管理
4. 操作日志记录

**好处**：
- ✅ 非技术人员也能操作
- ✅ 减少操作错误
- ✅ 提高更新效率
- ✅ 统一管理界面

---

## 📋 每次更新的检查清单

### 更新前
- [ ] 确认 Excel 文件格式正确
- [ ] 检查数据完整性
- [ ] 备份当前数据（系统自动备份）

### 更新中
- [ ] 上传文件
- [ ] 等待处理完成
- [ ] 查看更新结果

### 更新后
- [ ] 验证前端数据是否更新
- [ ] 测试相关功能是否正常
- [ ] 检查备份文件是否生成

---

## ⚠️ 重要提醒

### 数据备份
- ✅ **学校总览数据**：系统自动备份到 `backups/` 目录
- ⚠️ **合格实绩数据**：当前需要手动备份，增强后台后也会自动备份

### 数据格式
- 确保 Excel 文件包含必需的表头
- 检查数据格式是否正确
- 验证数据完整性

### 更新频率
- **学校总览**：每年 1-2 次（招生季开始前、中途修正）
- **合格实绩**：每年 1 次（新一年合格结果出来后）

---

## 🔧 技术实现建议

如果需要增强后台功能，建议：

1. **添加合格实绩数据上传接口**
   - 路由：`POST /api/admin/admission-score-update`
   - 功能：上传 Excel → 解析 → 运行分析算法 → 生成 JSON → 备份

2. **复用现有 Python 脚本逻辑**
   - 可以用 Node.js 重写分析算法
   - 或调用 Python 脚本（需要服务器支持）

3. **统一管理界面**
   - 在同一页面显示两种数据更新功能
   - 显示更新历史和备份列表

---

## 📞 遇到问题

### 常见问题

1. **上传失败**
   - 检查文件格式（.xlsx 或 .xls）
   - 检查文件大小（不超过 20MB）
   - 检查表头是否正确

2. **数据未更新**
   - 清除浏览器缓存
   - 检查服务器日志
   - 确认文件已成功上传

3. **需要回退**
   - 查看 `backups/` 目录
   - 手动恢复备份文件

---

## 📅 总结

### 当前状态
- ✅ **学校总览数据**：可以直接在后台上传更新
- ❌ **合格实绩数据**：需要手动运行脚本

### 推荐改进
- 🚀 **增强后台功能**：添加合格实绩数据上传功能
- 🎯 **统一操作流程**：两种数据都在后台更新
- ⏱️ **提高效率**：减少操作时间和技术门槛

### 操作建议
- **现在**：学校总览用后台，合格实绩用脚本
- **未来**：两种数据都用后台更新

---

*最后更新：2025-02-12*
